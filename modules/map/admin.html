<form data-name="Map">
	<label>Google Maps URL<br>
		<input type="text" class="userEnteredMapUrl" data-target="map-user"  style="width: 300px;" placeholder="Search on Google Maps and Copy URL here">
		<input type="hidden" class="embedUrl" data-target="map-embed" value="">
	</label>
	<caption>Title<br>
		<input type="text" data-target="caption" placeholder="Caption" value="Caption">
	</caption>

	<script>
		(function($) {
			$(".userEnteredMapUrl").each(function(index) {
				
				$(this).on("keyup", function() {
					var userEnteredMapUrl = $(this).val();

					if (userEnteredMapUrl.indexOf("@")>=0) {
						var urlElements = userEnteredMapUrl.split("@")[1].split("/data=")[0].split(",");

						var latitude = urlElements[0];
						var longitude = urlElements[1];
						var mapType;
						var zoom;

						var apiKey = "AIzaSyCIYiEC2rnfnoioDXXwt17q4OnvSZUYga4";

						if (urlElements.indexOf("z") >= 0) {
							mapType = "roadmap";
							zoom = urlElements[2].split("z");
						} else {
							mapType = "satellite";
							zoom = urlElements[2].split("m");
						}

						var embedUrl = "https://www.google.com/maps/embed/v1/view?key=" + apiKey + "&center=" + latitude + "," + longitude + "&zoom=" + zoom + "&maptype=" + mapType;
						$(this).siblings(".embedUrl").val(embedUrl);
					}
				});
			});
				
		})(jQuery);
	</script>

</form>
